{
    "$identifier": "ord:character_controller",
    "$inputs": { "character": 0, "character_string": "sonic", "is_super": 0 },
    "format_version": "1.21.40",
    "minecraft:attachable": {
        "description": {
            "materials": {
                "character": "entity_alphatest",
                "animated_additive": "gm1_ord_animated_additive",
                "transparent": "entity_alphablend"
            },
            "textures": {
                "character": "textures/gm1/ord/entity/character_^{character_string}^",
                "charge_01": "textures/gm1/ord/entity/charge/^{character_string}^_1",
                "charge_02": "textures/gm1/ord/entity/charge/^{character_string}^_2",
                "charge_03": "textures/gm1/ord/entity/charge/^{character_string}^_3",
                "charge_04": "textures/gm1/ord/entity/charge/^{character_string}^_4",
                "charge_05": "textures/gm1/ord/entity/charge/^{character_string}^_5",
                "trail_01": "textures/gm1/ord/entity/trail/^{character_string}^_1",
                "trail_02": "textures/gm1/ord/entity/trail/^{character_string}^_2",
                "trail_03": "textures/gm1/ord/entity/trail/^{character_string}^_3",
                "trail_04": "textures/gm1/ord/entity/trail/^{character_string}^_4",
                "trail_05": "textures/gm1/ord/entity/trail/^{character_string}^_5",
                "trail_06": "textures/gm1/ord/entity/trail/^{character_string}^_6",
                "trail_07": "textures/gm1/ord/entity/trail/^{character_string}^_7",
                "trail_08": "textures/gm1/ord/entity/trail/^{character_string}^_8",
                "trail_09": "textures/gm1/ord/entity/trail/^{character_string}^_9",
                "trail_10": "textures/gm1/ord/entity/trail/^{character_string}^_10",
                "trail_11": "textures/gm1/ord/entity/trail/^{character_string}^_11",
                "trail_12": "textures/gm1/ord/entity/trail/^{character_string}^_12",
                "trail_13": "textures/gm1/ord/entity/trail/^{character_string}^_13",
                "trail_14": "textures/gm1/ord/entity/trail/^{character_string}^_14",
                "trail_15": "textures/gm1/ord/entity/trail/^{character_string}^_15",
                "trail_16": "textures/gm1/ord/entity/trail/^{character_string}^_16",
                "shadow_home": "textures/gm1/ord/entity/charge/sonic_5",
                "invulnerable": "textures/gm1/ord/entity/invulnerable/^{character_string}^",
                "token": "textures/gm1/ord/items/gm1_^{character_string}^_token"
            },
            "geometry": {
                "character": "geometry.gm1_ord.character_^{character_string}^",
                "trail": "geometry.gm1_ord.character_^{character_string}^_trail",
                "character_shell": "geometry.gm1_ord.character_^{character_string}^_charge_shell",
                "token": "geometry.gm1_ord.character_life"
            },
            "animations": {
                "fp_body": "animation.gm1_ord.chaos_pg.first_person_body",
                "fp_arms": "animation.gm1_ord.chaos_pg.first_person_arms",
                "fp_glide": "animation.gm1_ord.knuckles_pg.glide_1st",
                "fp_jump": "animation.gm1_ord.chaos_pg.first_person_jump",
                "fp_knuckles_charge_right": "animation.gm1_ord.knuckles_pg.charge_right_1st",
                "fp_knuckles_charge_left": "animation.gm1_ord.knuckles_pg.charge_left_1st",
                "fp_punch_right": "animation.gm1_ord.knuckles_pg.punch_right_1st",
                "fp_punch_left": "animation.gm1_ord.knuckles_pg.punch_left_1st",
                "fp_shadow_charge": "animation.gm1_ord.shadow_pg.charge_1st",
                "fp_amy_charge": "animation.gm1_ord.amy_pg.charge_1st",
                "fp_amy_hammer": "animation.gm1_ord.amy_pg.hammer_1st",
                "fp_hide_hammer": "animation.gm1_ord.amy.hammerhide_1st",
                "fp_tails_hover": "animation.gm1_ord.tails_pg.fly_1st",
                "fp_idle_rotation": "animation.gm1_ord.fp_rotation",
                "idle_controller": "controller.animation.gm1_ord.idle",
                "movement_controller": "controller.animation.gm1_ord.^{character_string}^_movement",
                "walk": "animation.gm1_ord.^{character_string}^_pg.jog",
                "walk_sonic_sound": "animation.gm1_ord.sonic.jog_sound",
                "run": "animation.gm1_ord.^{character_string}^_pg.run",
                "run_sonic_sound": "animation.gm1_ord.sonic.run_sound",
                "sonic_riding": "animation.gm1_ord.sonic.ride",
                "sonic_slope": "animation.gm1_ord.^{character_string}^_pg.slope",
                "jump_sound": "animation.gm1_ord.jump_sound",
                "yaw": "animation.gm1_ord.chaos_pg.yaw",
                "bob": "animation.gm1_ord.chaos_pg.bob",
                "jump": "animation.gm1_ord.chaos_pg.jump",
                "ball": "animation.gm1_ord.^{character_string}^.ball",
                "flight": "animation.gm1_ord.super_sonic_pg.flight",
                "shadow_flight": "animation.gm1_ord.super_shadow_pg.flight",
                "super_hover": "animation.gm1_ord.super_sonic.super_hover",
                "stop": "animation.gm1_ord.chaos_pg.stop",
                "ring_loss": "animation.gm1_ord.ring_loss",
                "idle_1": "animation.gm1_ord.^{character_string}^_pg.idle_1",
                "idle_2": "animation.gm1_ord.^{character_string}^_pg.idle_2",
                "idle_3": "animation.gm1_ord.^{character_string}^_pg.idle_3",
                "timer_0": "animation.gm1_ord.chaos_pg.timer_0",
                "timer_1": "animation.gm1_ord.chaos_pg.timer_1",
                "ability_sonic_controller": "controller.animation.sonic_ability",
                "charge": "animation.gm1_ord.^{character_string}^_pg.charge",
                "transformation": "animation.gm1_ord.character_sonic.transformation",
                "transformation_particle": "animation.gm1_ord.transform.particle_vfx",
                "transform_controller": "controller.animation.gm1_ord.transformation",
                "detransform_controller": "controller.animation.gm1_ord.detransformation",
                "ability_charge_controller": "controller.animation.gm1_ord.^{character_string}^_charge",
                "charge_level": "animation.gm1_ord.chaos_pg.charge_level",
                "blink_controller": "controller.animation.gm1_ord.blink",
                "eyes_open": "animation.gm1_ord.chaos_pg.open_eyes",
                "eyes_close": "animation.gm1_ord.chaos_pg.close_eyes",
                "target_eyes": "animation.gm1_ord.chaos_pg.target_eyes",
                "negate_sneaking_tilt": "animation.player.sneaking.inverted",
                "flycam": "animation.gm1_ord.player.flycam",
                "body_direction": "animation.gm1_ord.player.body_direction",
                "jog_sound": "animation.gm1_ord.^{character_string}^.jog_sound",
                "run_sound": "animation.gm1_ord.^{character_string}^.run_sound",
                "top_speed.sfx": "controller.animation.gm1_ord.max_speed",
                "charging_vfx": "animation.gm1_ord.charging.vfx",
                "trail_scale": "animation.gm1_ord.character.trail_scale",
                "charge_lightning": "animation.gm1_ord.charge_lightning.sound",
                "liquid_running_offset": "animation.gm1_ord.character.liquid_running_offset",
                "liquid_running_offset_controller": "controller.animation.gm1_ord.character.liquid_running_offset",
                "liquid_running_controller": "controller.animation.gm1_ord.liquid_running",
                "water_running": "animation.gm1_ord.water_running_particle",
                "lava_running": "animation.gm1_ord.lava_running_particle",
                "snow_running": "animation.gm1_ord.snow_running_particle",
                "breakthrough_anim": "animation.gm1_ord.breakthrough.vfx",
                "speed_lines": "animation.gm1_ord.speed_lines",
                "jump_effects_controller": "controller.animation.jump_effects_^{character_string}^"
            },
            "scripts": {
                "initialize": [
                    "v.is_super = ^{is_super}^;",
                    "v.is_moving = 0;",
                    "v.time_standing_still = 0;",
                    "v.punch_variant = 0;",
                    "v.charge_variant = 0;",
                    "v.chosen_idle = 0;",
                    "v.chosen_attack = 0;",
                    "v.map_angle = 0;",
                    "v.player_x_rotation = 0;",
                    "v.is_first_person = c.is_first_person;",
                    "v.character = ^{character}^;",
                    "v.helmet_slot = 0;",
                    "v.mod_move_speed = 0;",
                    "v.air_time = 0;",
                    "v.distance_from_camera = 0;",
                    "v.random_start = 0;",
                    "v.item_durability = 0;",
                    "v.jumped_recently = 0;",
                    "v.speed_scale = 0;",
                    "v.has_transform_helmet = 0;",
                    "v.transforming = 0;",
                    "v.transforming_in_seconds = 0;",
                    "v.is_transformed = 0;",
                    "v.ability_state = 0;",
                    "v.in_ability_time = 0;",
                    "v.is_block_breaking = 0;",
                    "v.blocks_per_second = 0;",
                    "v.secondary_state = 0;",
                    "v.water_running = 0;",
                    "v.snow_running = 0;",
                    "v.liquid_running = 0;",
                    "v.momentum = 0;",
                    "v.momentum_run_threshold = 6;",
                    "v.momentum_lerped = 0;",
                    "v.ballmode = 0;",
                    "v.liquid_running = 0;",
                    "v.liquid_transform_buffer = 0;",
                    "v.liquid_running_state_1 = 0;",
                    "v.liquid_running_state_2 = 0;",
                    "v.time_stamp_lerped = q.time_stamp/20;",
                    "v.chaosdash = 0;",
                    "v.time_stamp = q.time_stamp/20;",
                    "v.time_anim = q.anim_time;",
                    "variable.position_x_delta = 0;",
                    "variable.position_z_delta = 0;",
                    "variable.direction_delta = 0;",
                    "v.is_position_delta_zero = 1;",
                    "variable.previous_position_x_delta = 0;",
                    "variable.previous_position_z_delta = 0;",
                    "v.flycam_turned_on = 0;",
                    "variable.rotation_delta = 0;",
                    "v.texture_index = 0;",
                    "v.charge_texture_index = 0;",
                    "v.detransforming = 0;",
                    "v.liquid_running = 0;",
                    "v.is_invulnerable = 0;",
                    "v.invulnerable_frequency = 0;",
                    "v.time_since_in_ability = 0;",
                    "v.time_since_ability_active = 0;",
                    "v.is_doublejumping = 0;",
                    "v.is_jumping = 0;",
                    "v.is_grounded = 0;",
                    "v.is_grounded_timer = 0.0;",
                    "v.time_as_character = 0.0;",
                    "v.going_super_timer = 0.0;"
                ],
                "pre_animation": [
                    "v.is_first_person = c.is_first_person;",
                    "v.player_x_rotation = c.owning_entity -> query.bone_rotation('head');",
                    "variable.map_angle = math.clamp(1.2 - variable.player_x_rotation.x / 105, 0.0, 1.0);",
                    "v.punch_variant = v.punch_variant;",
                    "v.charge_variant = v.charge_variant;",
                    "v.mod_move_speed = c.owning_entity -> q.modified_move_speed;",
                    "v.is_moving = v.mod_move_speed > 0.2 ? 1 : 0;",
                    "v.is_jumping = v.secondary_state == 9;",
                    "v.jumped_recently = v.is_jumping ? 1 : v.jumped_recently;",
                    "v.liquid_transform_buffer = v.liquid_running ? 5 : (v.liquid_transform_buffer > 0 && !v.is_jumping ? v.liquid_transform_buffer - 1 : 0);",
                    "v.air_time = !v.liquid_running && !q.is_on_ground ? v.air_time + 1 * q.delta_time : 0;",
                    "v.liquid_running_state_1 = (v.air_time > 0 && v.liquid_transform_buffer == 0);",
                    "v.jumped_recently = !v.liquid_running && (v.liquid_running_state_1 || v.liquid_running_state_2 ) && v.secondary_state != 7 ? v.jumped_recently : 0;",
                    "v.liquid_running_state_2 = (v.air_time == 0 && v.liquid_transform_buffer > 0);",
                    "v.distance_from_camera = query.distance_from_camera;",
                    "v.item_durability = query.armor_damage_slot(1);",
                    "v.is_grounded = c.owning_entity -> query.is_on_ground;",
                    "v.is_grounded_timer = v.is_grounded && v.is_grounded_timer < 2.0 ? v.is_grounded_timer + 1 * query.delta_time : v.is_grounded_timer;",
                    "v.is_grounded_timer = !v.is_grounded ? 0 : v.is_grounded_timer;",
                    "v.speed_scale = q.ground_speed > 10 ? (q.ground_speed-10)/2 : 0;",
                    "v.helmet_slot = c.owning_entity -> q.armor_damage_slot(0);",
                    "v.has_transform_helmet = c.owning_entity -> query.is_item_name_any('slot.armor.head','gm1_ord:transform_helmet_^{character_string}^') ? 1 : 0;",
                    "v.time_as_character = v.has_transform_helmet ? v.time_as_character + 1 * q.delta_time : 0;",
                    "v.transforming = q.armor_damage_slot(0) == 2 ? 1 : 0;",
                    "v.detransforming = q.armor_damage_slot(0) == 1 ? 1 : 0;",
                    "v.is_losing_life = q.armor_damage_slot(0) == 4 ? 1 : 0;",
                    "v.transforming_in_seconds = query.item_in_use_duration/400;",
                    "v.is_transformed = v.has_transform_helmet && (q.armor_damage_slot(0) == 0 || q.armor_damage_slot(0) == 1 || q.armor_damage_slot(0) == 3 || q.armor_damage_slot(0) == 5);",
                    "v.ability_state = c.owning_entity -> query.armor_damage_slot(1);",
                    "v.is_doublejumping = v.secondary_state == 4 ? 1 : v.is_doublejumping;",
                    "v.is_doublejumping = v.jumped_recently == 0 ? 0 : v.is_doublejumping;",
                    "v.is_block_breaking = v.ability_state == 8 ? 1 : v.is_block_breaking;",
                    "v.time_since_ability_active = v.in_ability_time > 0 && v.ability_state <= 0 ? 1 : v.time_since_ability_active;",
                    "v.time_since_in_ability = v.time_since_ability_active ? v.time_since_in_ability + 1 * q.delta_time : 0;",
                    "v.time_since_ability_active = v.time_since_in_ability > 1.0 || v.ability_state > 0 ? 0 : v.time_since_ability_active;",
                    "v.in_ability_time = v.ability_state > 0 ? v.in_ability_time + 1 * q.delta_time : 0;",
                    "v.blocks_per_second = q.ground_speed;",
                    "v.secondary_state = c.owning_entity -> query.armor_damage_slot(2);",
                    "v.water_running = v.secondary_state == 2;",
                    "v.is_creative_flight = v.secondary_state == 7;",
                    "v.snow_running = v.secondary_state == 8;",
                    "v.liquid_running = v.secondary_state == 8 || v.secondary_state == 2;",
                    "v.momentum = c.owning_entity -> query.armor_damage_slot(3);",
                    "v.ballmode = v.character <= 1 && (v.ability_state > 0 && v.in_ability_time > 0.33) || (v.secondary_state == 1 && v.character == 0) ? 1 : v.ballmode;",
                    "v.chaosdash = v.secondary_state == 1 ? 1 : v.chaosdash;",
                    "v.ballmode = ((v.momentum < 6 || q.is_on_ground) && v.ability_state <= 0 && v.ability_state != 9 && v.secondary_state != 1 && (v.time_since_in_ability > 0.4 || v.time_since_in_ability <= 0)) || v.secondary_state == 3 || v.secondary_state == 7 || v.secondary_state == 4 || (v.is_super && v.ability_state == 8) ? 0 : v.ballmode;",
                    "v.momentum_lerped = math.lerp(v.momentum_lerped, v.momentum, 0.1);",
                    "v.time_standing_still = !q.is_moving ? v.time_standing_still + 1 * q.delta_time : 0;",
                    "v.chosen_idle = v.time_standing_still >= 10 && v.chosen_idle == 0 && !v.is_creative_flight ? math.random_integer(1,3) : v.chosen_idle ;",
                    "v.chosen_idle = v.time_standing_still < 10 && v.chosen_idle != 0 || v.is_creative_flight ? 0 : v.chosen_idle;",
                    "v.time_stamp_lerped = math.lerp(v.time_stamp_lerped,v.time_stamp,0.1);",
                    "v.time_stamp = q.time_stamp/20;",
                    "v.time_anim = q.anim_time;",
                    "v.body_y_rotation = c.owning_entity -> query.body_y_rotation;",
                    "variable.position_x_delta = c.owning_entity -> query.position_delta(0);",
                    "variable.position_y_delta = c.owning_entity -> query.position_delta(1);",
                    "variable.position_z_delta = c.owning_entity -> query.position_delta(2);",
                    "variable.position_x_delta = variable.position_x_delta == 0 ? v.previous_position_x_delta : variable.position_x_delta;",
                    "variable.position_z_delta = variable.position_z_delta == 0 ? v.previous_position_z_delta : variable.position_z_delta;",
                    "v.previous_position_x_delta = variable.position_x_delta;",
                    "v.previous_position_z_delta = variable.position_z_delta;",
                    "variable.direction_delta = math.sqrt(math.pow(variable.position_x_delta,2.0) + math.pow(variable.position_z_delta,2.0));",
                    "v.delta_y_rot = math.atan2(-v.position_y_delta + 0.0784, variable.direction_delta);",
                    "v.delta_y_rot_lerp = (variable.direction_delta < 0.01) ? 0 : math.lerp(v.delta_y_rot_lerp ?? v.delta_y_rot, v.delta_y_rot, 0.1);",
                    "v.flycam_turned_on = !v.is_first_person && v.ability_state <= 0 && v.is_transformed ? 1 : 0;",
                    "variable.rotation_delta = v.mod_move_speed >= 0.2 ? math.lerprotate(variable.rotation_delta, math.mod(math.atan2(variable.position_z_delta,variable.position_x_delta)-90,360), 0.1) : (q.is_sprinting ? q.head_y_rotation(0) : variable.rotation_delta);",
                    "variable.life_time = c.owning_entity -> query.life_time;",
                    "v.texture_index = math.mod(math.floor(variable.life_time * 16), 16);",
                    "v.charge_texture_index = math.round(((1+math.sin(v.life_time*(180*v.ability_state)))/2)*4);",
                    "v.super_texture_index = math.round(((1+math.sin(v.life_time*360))/2)*4);",
                    "variable.yaw_speed = c.owning_entity -> query.yaw_speed;",
                    "v.turn_amount = math.clamp(variable.yaw_speed, -100, 100);",
                    "v.turn_lerped = math.lerp(variable.turn_lerped ?? 0, variable.turn_amount, 0.2);",
                    "v.is_block_breaking = v.is_block_breaking == 1 && v.ability_state != 8 ? 0 : v.is_block_breaking;",
                    "v.is_invulnerable = v.helmet_slot == 3 ? 1 : 0;",
                    "v.invulnerable_frequency = v.is_invulnerable ? math.round((math.sin(query.anim_time*720)+1)*0.5) : 0;",
                    "v.going_super_timer = v.helmet_slot == 5 ? v.going_super_timer + 1 * q.delta_time : 0;"
                ]
            },
            "particle_effects": {
                "transform_light_blip": "gm1_ord:transform_light_blip",
                "charge_vfx": "gm1_ord:charge_^{character_string}^",
                "water_running": "gm1_ord:water_running",
                "snow_running": "gm1_ord:snow_running",
                "breakthrough": "gm1_ord:breakthrough",
                "speed_lines_lower": "gm1_ord:speed_lines_lower",
                "speed_lines_upper": "gm1_ord:speed_lines_upper"
            },
            "sound_effects": {
                "player_jump": "character_jump",
                "transform_jingle": "transform_jingle",
                "super_transform_jingle": "super_transform_jingle",
                "transform_charge": "transform_charge",
                "step": "player_step",
                "water_step": "water_step",
                "lava_step": "lava_step",
                "snow_step": "snow_step",
                "top_speed": "top_speed",
                "charge_lightning": "charge_lightning"
            }
        }
    }
}